<h1>My Wishlist</h1>

<% if @wishlist_items.empty? %>
  <div class="alert alert-info">
    Your wishlist is empty. <%= link_to 'Browse books', root_path, class: 'alert-link' %> to add some!
  </div>
<% else %>
  <p class="text-muted mb-4"><%= pluralize(@wishlist_items.count, 'item') %> in your wishlist</p>

  <div class="row">
    <% @wishlist_items.each do |item| %>
      <div class="col-md-4 mb-4">
        <div class="card h-100">
          <% if item.book.image.attached? %>
            <%= image_tag item.book.image, class: 'card-img-top', style: 'height: 250px; object-fit: cover;', alt: item.book.title %>
          <% else %>
            <%= image_tag 'placeholder_book.svg', class: 'card-img-top', style: 'height: 250px; object-fit: contain; padding: 40px; background-color: #f8f9fa;', alt: 'Book placeholder' %>
          <% end %>
          <div class="card-body">
            <h5 class="card-title"><%= item.book.title %></h5>
            <h6 class="card-subtitle mb-2 text-muted"><%= item.book.author %></h6>
            <p class="card-text"><%= truncate(item.book.description, length: 100) if item.book.description %></p>
            <p class="text-success fw-bold">$<%= item.book.price %></p>
            <p class="text-muted">Stock: <%= item.book.stock %></p>
          </div>
          <div class="card-footer bg-transparent">
            <% if item.book.in_stock? %>
              <%= button_to 'Add to Cart', add_item_cart_path(book_id: item.book.id), method: :post, class: 'btn btn-sm btn-success w-100 mb-2' %>
            <% else %>
              <button class="btn btn-sm btn-secondary w-100 mb-2" disabled>Out of Stock</button>
            <% end %>
            <div class="d-flex gap-2">
              <%= link_to 'View', item.book, class: 'btn btn-sm btn-info flex-fill', data: { turbo_frame: "_top" } %>
              <%= button_to 'Remove', wishlist_remove_item_path(item.id), method: :delete, data: { turbo_confirm: 'Remove from wishlist?' }, class: 'btn btn-sm btn-danger flex-fill' %>
            </div>
          </div>
        </div>
      </div>
    <% end %>
  </div>
<% end %>

<div class="mt-3">
  <%= link_to 'Continue Shopping', root_path, class: 'btn btn-outline-secondary' %>
</div>
