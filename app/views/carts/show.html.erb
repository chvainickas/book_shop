<div class="row">
  <div class="col-md-8">
    <h1>Shopping Cart</h1>

    <% if @cart_items.empty? %>
      <div class="alert alert-info">
        Your cart is empty. <%= link_to 'Browse books', root_path, class: 'alert-link' %>
      </div>
    <% else %>
      <div class="card">
        <div class="card-body">
          <% @cart_items.each do |item| %>
            <div class="row mb-3 pb-3 border-bottom">
              <div class="col-md-2">
                <% if item.book.image.attached? %>
                  <%= image_tag item.book.image, class: 'img-fluid rounded', alt: item.book.title %>
                <% else %>
                  <%= image_tag 'placeholder_book.svg', class: 'img-fluid rounded', alt: 'Book placeholder' %>
                <% end %>
              </div>
              <div class="col-md-6">
                <h5><%= link_to item.book.title, item.book %></h5>
                <p class="text-muted mb-1">by <%= item.book.author %></p>
                <p class="text-success fw-bold mb-0">$<%= item.book.price %></p>
                <% if item.book.stock < item.quantity %>
                  <p class="text-danger small mb-0">Only <%= item.book.stock %> in stock!</p>
                <% end %>
              </div>
              <div class="col-md-2">
                <%= form_with url: update_item_cart_path(item.id), method: :patch, data: { turbo: false }, class: 'd-flex align-items-center' do |f| %>
                  <%= f.number_field :quantity, value: item.quantity, min: 1, max: item.book.stock, class: 'form-control form-control-sm', onchange: 'this.form.requestSubmit()' %>
                <% end %>
              </div>
              <div class="col-md-2 text-end">
                <p class="fw-bold mb-2">$<%= '%.2f' % item.subtotal %></p>
                <%= button_to 'Remove', remove_item_cart_path(item.id), method: :delete, data: { turbo_confirm: 'Are you sure?' }, class: 'btn btn-sm btn-danger' %>
              </div>
            </div>
          <% end %>
        </div>
      </div>

      <div class="mt-3">
        <%= button_to 'Clear Cart', clear_cart_path, method: :delete, data: { turbo_confirm: 'Are you sure you want to clear your cart?' }, class: 'btn btn-outline-danger' %>
      </div>
    <% end %>
  </div>

  <% unless @cart_items.empty? %>
    <div class="col-md-4">
      <div class="card">
        <div class="card-body">
          <h4 class="card-title">Order Summary</h4>
          <hr>
          <div class="d-flex justify-content-between mb-2">
            <span>Items (<%= @cart.item_count %>):</span>
            <span>$<%= '%.2f' % @cart.total %></span>
          </div>
          <hr>
          <div class="d-flex justify-content-between mb-3">
            <strong>Total:</strong>
            <strong class="text-success">$<%= '%.2f' % @cart.total %></strong>
          </div>
          <%= link_to 'Proceed to Checkout', new_order_path, class: 'btn btn-primary w-100 btn-lg' %>
          <%= link_to 'Continue Shopping', root_path, class: 'btn btn-outline-secondary w-100 mt-2' %>
        </div>
      </div>
    </div>
  <% end %>
</div>
